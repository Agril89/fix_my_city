<!doctype html>
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>FixMyCity</title>

	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/ol.css" type="text/css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="icon" href="img/favicon.ico">

</head>
<body>
		<header>
			<nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
				<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<a href="#" class="navbar-brand"><img style="max-width:100px; margin-top: -7px;" src="img/logo-main.png"></a>
				<div class="collapse navbar-collapse" id="navbarCollapse">
					<ul class="navbar-nav mr-auto">
						<li class="nav-item">
							<a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="map.html">Maps</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="#">About Us</a>
						</li>
						<li class="nav-item">
							<a class="nav-link disabled" href="#">How it work</a>
						</li>
					</ul>
					<form class="form-inline mt-2 mt-md-0" name="modulo">
						<!--<input class="form-control mr-sm-2" type="text" placeholder="Username" name="u_id">
						<input class="form-control mr-sm-2" type="password" placeholder="Password" name="pass">-->
						<input class="btn btn-outline-success my-2 my-sm-0" type="button" value="Login" onclick="XML_Login()">			
						<a class="nav-link" href="register.html">Registrati</a>
					</form>
				</div>	
			</nav>
		</header>
	<div class="container-fluid">
      <div class="row">
        <div class="col-md-7">
			<div id="map"></div>
				<div id="popup" class="ol-popup">
				<a href="#" id="popup-closer" class="ol-popup-closer"></a>
				<div id="popup-content"></div>
			</div>
		</div>
        <div class="col-md-5">
			<div class="map_sidebar"></div>
		</div>
      </div>			
	</div>

	
	<footer>
	<div class="container-fluid">
		<div class="row">
			<footer class="footer fixed-bottom">
				<div class="col-12 copyright">
					<p>Copyright Â©2017. All Rights Reserved. Powered by Luca Roatta & Simone Hu</p>
				</div>
			</footer>	
		</div>
	</div>
	</footer>
	
	
	<script src="js/jquery-3.2.0.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/ol.js"></script>
	
	<script>
		jQuery(document).ready(function($){
			$("a.attiva-nav").click(function() {
				$("nav").slideToggle();
				$(this).toggleClass("active");
			});
			
			$(window).resize(function() {
				var windowsize = $(window).width();
				if (windowsize > 600) {
					$('nav').css('display', '');
				}
			});
			
		});
	</script>
				<script type="text/javascript">	  
					var container = document.getElementById('popup');
					var content = document.getElementById('popup-content');
					var closer = document.getElementById('popup-closer');

					/**
					* Create an overlay to anchor the popup to the map.
					*/
					var overlay = new ol.Overlay(/** @type {olx.OverlayOptions} */ ({
						element: container,
						positioning: 'bottom-center',
						stopEvent: false,
						offset: [0, -50],
						autoPan: true,
						autoPanAnimation: {
							duration: 250
						}
					}));

					/**
					* Add a click handler to hide the popup.
					* @return {boolean} Don't follow the href.
					*/
					closer.onclick = function() {
						overlay.setPosition(undefined);
						closer.blur();
						return false;
					};
				
					var iconStyle = new ol.style.Style({
						image: new ol.style.Icon({
							anchor: [0.5, 46],
							anchorXUnits: 'fraction',
							anchorYUnits: 'pixels',
							opacity: 0.75,
							src: 'img/pin.png'
						})
					});
					
					var vectorSource = new ol.source.Vector();
					var vectorLayer = new ol.layer.Vector({
						source: vectorSource
					});		

					map = new ol.Map({
						interactions : ol.interaction.defaults({doubleClickZoom :false}),
						target: document.getElementById('map'),
						view: new ol.View({
							center: [998727.43,5527988.53],
							zoom: 17,
							minZoom: 15,
							maxZoom: 19
						}),
						overlays: [overlay],
						layers: [new ol.layer.Tile({source: new ol.source.OSM()}), vectorLayer]
					});			
					
					map.on('dblclick', function(evt){
						var feature = new ol.Feature({
							geometry: new ol.geom.Point(evt.coordinate),
							name: 'Null Island',
							population: 4000,
							rainfall: 500
						});
						feature.setStyle(iconStyle);
						vectorSource.addFeature(feature);
					});	

					// display popup on click
					map.on('click', function(evt) {
						var feature = map.forEachFeatureAtPixel(evt.pixel,
							function(feature) {
								return feature;
							});
						if (feature) {
							var coordinates = feature.getGeometry().getCoordinates();
							overlay.setPosition(coordinates);
							content.innerHTML = feature.get('name', 'population');
						}
					});

					// change mouse cursor when over marker
					map.on('pointermove', function(e) {
						var pixel = map.getEventPixel(e.originalEvent);
						var hit = map.hasFeatureAtPixel(pixel);
						map.getTarget().style.cursor = hit ? 'pointer' : '';
					});		
				</script>	
</body>
</html>				